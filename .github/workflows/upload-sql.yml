name: Upload SQL Files to Azure Synapse

on:
  workflow_dispatch

jobs:
  upload-sql-files:
    runs-on: ubuntu-latest

    steps:
      - name: Install Azure CLI
        run: |
          curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash

      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Upload SQL Files to Azure Synapse
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Execute PowerShell Script
        shell: powershell
        run: |
          $localFolderPath = "C:\Users\Satyakumar_Surisetti\Documents\sqlfiles"
          $storageAccountName = "satyadldemo"
          $storageAccountKey = "qfzI4S8ydhvdIGLrNLAAOhD735FpbQCmzuUMCHzId9Te4n9gR+FVyDWBB9o7GZKMl66UyPB5l8Tj+AStzjTewA=="
          $containerName = "satyadlfs"

          az storage blob upload-batch --destination $containerName --source $localFolderPath --account-name $storageAccountName --account-key $storageAccountKey
